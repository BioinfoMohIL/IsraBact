
# exit task if anything throws an error (important for proper gzip format)
set -euo pipefail
    
exists() { [[ -f $1 ]]; }

cat /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/HI29832_S30_L001_R1_001.fastq.gz /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/HI29832_S30_L002_R1_001.fastq.gz /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/HI29832_S30_L003_R1_001.fastq.gz /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/HI29832_S30_L004_R1_001.fastq.gz > "HI29832_merged_R1.fastq.gz"

# Fetch the file size in MB
fwd_file_size=$(stat -c%s "HI29832_merged_R1.fastq.gz")
fwd_file_size_mb=$(awk -v size="$fwd_file_size" 'BEGIN {printf "%.2f", size / (1024*1024)}')
echo "$fwd_file_size_mb" > fwd_size.txt
        
if exists "/mnt/miniwdl_task_container/work/_miniwdl_inputs/0/HI29832_S30_L001_R2_001.fastq.gz" ; then
  cat /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/HI29832_S30_L001_R2_001.fastq.gz /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/HI29832_S30_L002_R2_001.fastq.gz /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/HI29832_S30_L003_R2_001.fastq.gz /mnt/miniwdl_task_container/work/_miniwdl_inputs/0/HI29832_S30_L004_R2_001.fastq.gz > "HI29832_merged_R2.fastq.gz"
    
  # Fetch the file size in MB
  rev_file_size=$(stat -c%s "HI29832_merged_R2.fastq.gz")
  rev_file_size_mb=$(awk -v size="$rev_file_size" 'BEGIN {printf "%.2f", size / (1024*1024)}')
  echo "$rev_file_size_mb" > rev_size.txt
fi

# ensure newly merged FASTQs are valid gzipped format
gzip -t *merged*.gz
  